# 8. 계층형 설계 1

## 소프트웨어 설계란 무엇입니까?

소프트웨어 설계

- 코드를 만들고, 테스트하고, 유지보수하기 쉬운 프로그래밍 방법을 선택하기 위해 미적 감각을 사용하는 것

## 계층형 설계란 무엇인가요?

- 소프트웨어를 계층으로 구성하는 기술
- 각 계층에 있는 함수는 바로 아래 계층에 있는 함수를 이용해 정의
- 각 계층은 특정 추상화 수준을 가지며, 상호 독립적으로 동작

## 계층형 설계 패턴

1. **직접 구현**
2. **추상화 벽**
3. **작은 인터페이스**
4. **편리한 계층**

## 패턴 1: 직접 구현

### 정의

- 상위 계층에서 하위 계층의 동작을 직접 정의하는 방식
- 직접 구현된 함수를 읽을 때, 함수 시그니처가 나타내고 있는 문제를 함수 본문에서 적절한 구체화 수준에서 해결
- 즉, 직접구현은 책임을 분리해서 여러 계층을 독립적으로 구현하는 방법을 의미

### 특징

- 호출 그래프를 만들어서 함수 호출을 시각화한다.
- **같은 계층에 있는 함수는 같은 목적을 가져야 한다.**
  - 각 계층은 추상화 수준이 다르기 때문에 어떤 계층에 있는 함수를 읽거나 고칠 때 낮은 수준의 구체적인 내용은 신경쓰지 않아도 된다.

## 3단계 줌 레벨

1. 계층 사이에 상호 관계
2. 특정 계층의 구현
3. 특정 함수의 구현

### 1. 전역 줌 레벨

- 그래프 전체 중 필요한 부분을 살펴볼 수 있는 기본 줌 레벨이다.
- 계층 사이에 상호 관계를 포함해서 모든 문제 영역을 살펴볼 수 있다.

### 2. 계층 줌 레벨

- 한 계층과 연결된 바로 아래 계층을 볼 수 있는 줌 레벨
- 계층이 어떻게 구현되어 있는지 알 수 있다.

### 3. 함수 줌 레벨

- 함수 하나와 바로 아래 연결된 함수들을 볼 수 있다.
- 함수 구현의 문제를 찾을 수 있다.

⇒ 다양한 줌 레벨로 설계 문제를 찾거나 고칠 수 있다.

# 9. 계층형 설계 2

## 패턴2: 추상화 벽

- 추상화 벽은 세부 구현을 감춘 함수로 이루어진 계층이다.
- 추상화 벽에 있는 함수를 사용할 때는 구현을 전혀 몰라도 함수를 사용할 수 있다.
  - ⇒ 그렇기 때문에 추상화 벽은 팀 간 책임을 명확하게 나눈다.
- 추상화 벽을 가로 지르는 함수 호출 화살표가 없어야 한다.
  - 추상화 벽을 가로 지르는 함수가 있다면 추상화 벽에 새로운 함수를 만들면 된다.

## 추상화 벽은 언제 사용하면 좋을까요?

1. 쉽게 구현을 바꾸기 위해
2. 코드를 읽고 쓰기 쉽게 만들기 위해
3. 팀 간에 조율해야 할 것을 줄이기 위해
4. 주어진 문제에 집중하기 위해

⇒ 추상화 벽을 사용하면 코드의 의존성을 없앨 수 있고 코드를 쉽게 고칠 수 있으며 팀 간 커뮤니케이션 비용을 줄일 수 있다.

## 패턴3: 작은 인터페이스

- 새로운 코드를 추가할 위치에 관한 패턴
- 인터페이스를 최소화하면 하위 계층에 불필요한 기능이 쓸데없이 커지는 것을 막을 수 있다.
- 추상화 벽 위에 있는 계층에 구현하는 것이 좋다.

### 추상화 벽을 작게 만들어야 하는 이유

1. 추상화 벽에 코드가 많을수록 구현이 변경되었을 때 고쳐야 할 것이 많다.
2. 추상화 벽에 있는 코드는 낮은 수준의 코드이기 때문에 더 많은 버그가 있을 수 있다.
3. 낮은 수준의 코드는 이해하기 더 어렵다.
4. 추상화 벽에 코드가 많을수록 팀 간 조율해야 할 것도 많아진다.
5. 추상화 벽에 인터페이스가 많으면 알아야 할 것이 많아 사용하기 어렵다.

## 패턴4: 편리한 계층

- 다른 패턴과 다르게 조금 더 현실적이고 실용적인 측면
- 언제 패턴을 적용하고 언제 멈춰야 하는지를 알려줌
  - 작업하는 코드가 편리하다고 느끼면 설계를 멈춰도 된다.

## 그래프로 알 수 있는 코드에 대한 정보는 무엇이 있을까?

- 기능적 요구사항 - 소프트웨어가 정확히 해야하는 일
- 호출 그래프의 구조는 세 가지 중요한 비기능적 요구사항을 보여준다.

1. 유지보수성: 요구 사하잉 바뀌었을 때 가장 쉽게 고칠 수 있는 코드는 어떤 코드인가?
2. 테스트성: 어떤 것을 테스트하는 것이 가장 중요한가?
3. 재사용성: 어떤 함수가 재사용하기 좋은가?

## 그래프의 가장 위에 있는 코드가 고치기 가장 쉽습니다.

- 가장 위에 있는 함수는 아무 곳에서도 호출하는 곳이 없기 때문에 바꿀 때 고민하지 않아도 된다.
  - 다른 코드에 영향을 주지 않고 변경할 수 있다.
- 시간이 지나도 변하지 않는 코드는 가장 아래 계층에 있어야 한다.
  - 가장 낮은 계층에 있는 함수는 상위 계층에 영향을 주기 때문 ⇒ 고치기 어려움
- 자주 바뀌는 코드는 그래프 위에 있을수록 쉽게 일할 수 있지만, 바뀌는 것이 많은 가장 높은 곳은 적게 유지하는 것이 좋다.

## 아래에 있는 코드는 테스트가 중요합니다.

- 모든 코드를 테스트하는 것은 현실적이지 않다.
  - 좋은 결과를 얻기 위해 아래 있는 것을 테스트하는게 좋다.
- 상위 계층의 코드는 자주 바뀌는 코드이기 때문에 테스트가 오래가지 않는다.
- 하위 계층 코드를 테스트할수록 얻은 것이 더 오래간다.

## 아래에 있는 코드가 재사용하기 더 좋다

- 낮은 계층으로 함수를 추출하면 재사용할 가능성이 많아진다.
- 아래쪽으로 가리키는 화살표가 많은 함수는 재사용하기 어렵다.
